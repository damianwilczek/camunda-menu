
<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="utf-8">
        <meta name="robots" content="noindex">

        <title>Camunda Training - Menu</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
        <link href="css/style.css" rel="stylesheet" >
        <script src="js/jquery.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="https://apis.google.com/js/client.js?onload=checkAuth"></script>
        <script>var autoRefresh = '';</script>
    </head>
    <body onload="loadDashboard();">
        <section style="background:#efefe9;">
            <div class="container">
                <div class="row">
                    <div class="board">
                        <div class="board-inner">
                            <ul class="nav nav-tabs" id="myTab">
                                <div class="liner"></div>
                                <li class="active"><a onclick="loadDashboard();" href="#dashboard" data-toggle="tab" title="Dashboard"><span class="round-tabs one"><i class="glyphicon glyphicon-home"></i></span></a></li>
                                <li><a href="#response" onclick="autoRefresh = setInterval(function(){ getSelected(); }, 2000);" data-toggle="tab" title="Response"><span class="round-tabs two"><i class="glyphicon glyphicon-heart"></i></span></a></li>
                                <li><a href="#locations" onclick="getLocation()" data-toggle="tab" title="Locations"><span class="round-tabs three"><i class="glyphicon glyphicon-map-marker"></i></span> </a></li>
                                <li><a href="#gerichte" onclick="getFoodLocations();" data-toggle="tab" title="Gerichte"><span class="round-tabs four"><i class="glyphicon glyphicon-apple"></i></span></a></li>
                                <li><a href="#settings" onclick="getSettings();" data-toggle="tab" title="App settings"><span class="round-tabs five"><i class="glyphicon glyphicon-cog"></i></span></a></li>
                            </ul>
                        </div>
                        <div class="tab-content">
                            <div class="tab-pane fade in active" id="dashboard">
                                <h3 class="head text-center">Dashboard</h3>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <h4 class="text-center">Ausgewaehlte Location</h4>
                                                <h3 style="font-size: 3em;color: dodgerblue;" class="head text-center" id="dashboardLocation">joe'y pizza</h3>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <h4 class="text-center">Uhrzeit</h4>
                                                <h3 style="font-size: 3em;color: dodgerblue;" class="head text-center">14:00</h3>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <h4 class="text-center">Teilnehmern geantwortet</h4>
                                                <h3 style="font-size: 12em;color: dodgerblue;" class="head text-center"><span id="countCustomers"></span><span id="dashboardAmount"></span></h3>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">

                                            </div>
                                        </div>
                                        <br /><br /><br />
                                    </div>

                                </div>
                                <div class="row" id="authorize-div" style="display: none">
                                    <div class="col-md-4"></div>
                                    <div class="col-md-4">
                                        <h3 class="head text-center">Authorize access to Drive API</h3>
                                        <!--Button for the user to click to initiate auth sequence -->
                                        <button class="btn btn-warning" type="button" id="authorize-button" onclick="handleAuthClick(event)">
                                            Authorize
                                        </button>
                                    </div>
                                    <div class="col-md-4"></div>
                                </div>

                            </div>
                            <div class="tab-pane fade" id="response">
                                <h3 class="head text-center">Ausgewaehlte Gerichte</h3>

                                <div class="row">
                                    <div class="col-md-2"></div>
                                    <div class="col-md-8">
                                        <ul class="list-group" id="selectedFood">

                                        </ul>
                                    </div>
                                    <div class="col-md-2"></div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4"></div>
                                    <div class="col-md-4 text-center">
                                        <button class="btn btn-danger" type="button" id="removevote" onclick="removeVotes()">Remove all votes!</button>
                                    </div>
                                    <div class="col-md-4"></div>

                                </div>
                                <div class="row"><br /> </div>


                            </div>
                            <div class="tab-pane fade" id="locations">
                                <h3 class="head text-center">Locations</h3>
                                <div class="row">
                                    <div class="col-md-2"></div>
                                    <div class="col-md-8">
                                        <ul class="list-group" id="showLocations">

                                        </ul>
                                    </div>
                                    <div class="col-md-2"></div>
                                </div>
                                <div class="row">
                                    <div class="col-md-1"></div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <span class="input-group-addon" id="location-prefix">New location name:</span>
                                            <input type="text" class="form-control" id="newLocation" aria-describedby="location-prefix" placeholder="Type the new location name">
                                             <span class="input-group-btn"><button onclick="setLocation(document.getElementById('newLocation').value)"  class="btn btn-success" type="button">Add!</button></span>
                                        </div> <br /><br /><br />
                                    </div>
                                    <div class="col-md-1"></div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="gerichte">
                                <h3 class="head text-center">Gerichte</h3>
                                <div class="row">
                                    <div class="col-md-1"></div>
                                    <div class="col-md-10">
                                        <div class="form-group">
                                            <select class="form-control" id="foodLocationOptions" onchange="getFood(this.value);"></select>
                                        </div>
                                    </div>
                                    <div class="col-md-1"></div>
                                </div>
                                <div class="row">
                                    <div class="row">
                                        <div class="col-md-2"></div>
                                        <div class="col-md-8">
                                            <ul class="list-group" id="FoodList">

                                            </ul>
                                        </div>
                                        <div class="col-md-2"></div>
                                    </div>
                                    <div class="row" id="addfoodForm" style="display: none">
                                        <div class="col-md-1"></div>
                                        <div class="col-md-10">
                                            <div class="input-group">
                                                <span class="input-group-addon" id="location-prefix">Gericht hinzuf√ºgen:</span>
                                                <input type="text" class="form-control" id="newFood" placeholder="Type the new dish name" aria-describedby="location-prefix">
                                                <span class="input-group-btn"><button onclick="setFood(document.getElementById('newFood').value, document.getElementById('foodLocationOptions').value)" class="btn btn-success" type="button">Add!</button></span>
                                            </div> <br /><br /><br />
                                        </div>
                                        <div class="col-md-1"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="settings">
                                <h3 class="head text-center">App settings</h3>
                                <div class="row">
                                    <div class="col-md-1"></div>
                                    <div class="col-md-10">
                                        <div class="form-group">
                                            <select class="form-control" id="locationOptions" onchange="setLocationOption(this.value)">

                                            </select>
                                            <br />
                                            <select class="form-control" id="MemberAmount" onchange="setMemberAmount(this.value)"></select>
                                        </div>
                                    </div>
                                    <div class="col-md-1"></div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>

                    </div>
                </div>
            </div>
            <pre id="output"></pre>
        </section>

        <script type="text/javascript">
            $(function(){
                $('a[title]').tooltip();
            });

            function refreshData() {
                $.ajax({
                    type: "GET", url: "https://www.system-solution.it/test.php", success: function (msg) {
                        if (msg != 'error') {
                            var data = JSON.parse(msg);
                            localStorage.setItem("data", JSON.stringify(data));
                        }
                    }
                });
            }

            function setLocationOption(v){
                var data = JSON.parse(localStorage.getItem("data"));
                data.currentLocationId = v;
                localStorage.setItem("data", JSON.stringify(data));
                uploadData();
                loadDashboard();
            }

            function setMemberAmount(v){
                var data = JSON.parse(localStorage.getItem("data"));
                data.amount = v;
                localStorage.setItem("data", JSON.stringify(data));
                uploadData();
                loadDashboard();
            }

            function loadDashboard(){
                clearInterval(autoRefresh);
                refreshData();
                var data = JSON.parse(localStorage.getItem("data"));
                var location = (typeof data.Location[data.currentLocationId] !== 'undefined')?data.Location[data.currentLocationId].name:'<button onclick="getSettings();" data-toggle="tab"  class="btn btn-primary"><span class="glyphicon glyphicon-trash"></span> Set Location</button>';
                var amount = data.amount !== null?data.amount:0;

                document.getElementById('dashboardLocation').innerHTML = location;
                document.getElementById('dashboardAmount').innerHTML = '<sub>/' + amount + '</sub>';
                getSelected();
                uploadData();
            }

            function getLocation(){
                clearInterval(autoRefresh);
                var data = JSON.parse(localStorage.getItem("data"));
                var HTML = '';
                $.each(data.Location, function( key, value) {
                    HTML +=  '<li class="list-group-item borderless"><p>' + value.name + ' <button type="button" onclick="removeLocation('+key+')" class="btn btn-danger" style="float: right;"><span class="glyphicon glyphicon-trash"></span></button></p></li>';
                });
                document.getElementById('showLocations').innerHTML = HTML;
            }

            function setLocation(value){
                var data = JSON.parse(localStorage.getItem("data"));
                var id = 0;
                $.each(data.Location, function( key ) {
                   id = parseInt(key) + 1;
                })
                data.Location[id] = new Object();
                data.Location[id].name = value;
                document.getElementById('newLocation').value = '';
                localStorage.setItem("data", JSON.stringify(data));
                uploadData();
                getLocation();
            }

            function removeLocation(id){
                var data = JSON.parse(localStorage.getItem("data"));
                $.each(data.Location, function( key ) {
                    if(id == key) {
                        delete data.Location[key];
                    }
                });
                if(data.currentLocationId == id) {
                    setLocationOption(0);
                }
                $.each(data.Food, function( key, value) {
                    if(value.location == id) {
                        delete data.Food[key];
                    }
                });
                localStorage.setItem("data", JSON.stringify(data));
                uploadData();
                getLocation();
            }

            function getSettings(){
                clearInterval(autoRefresh);
                $('.nav-tabs a[href="#settings"]').tab('show');
                var data = JSON.parse(localStorage.getItem("data"));
                var HTML_Location = '<option selected disabled>Select location...</option>';
                $.each(data.Location, function( key, value) {
                    var selected = (data.currentLocationId == key)?'selected':'';
                    HTML_Location +=  '<option '+ selected +' value="'+key+'">' + value.name +'</option>';
                });
                i = 1;
                HTML_Amount = '<option selected disabled>Anzahl der Teilnehmer...</option>';
                while (i <= 12) {
                    var selected = (data.amount == i)?'selected':'';
                    HTML_Amount +=  '<option '+selected+' value="'+i+'">'+i+'</option>';
                    i++;
                }

                document.getElementById('locationOptions').innerHTML = HTML_Location;
                document.getElementById('MemberAmount').innerHTML = HTML_Amount;

            }

            function getFoodLocations(){
                clearInterval(autoRefresh);
                var data = JSON.parse(localStorage.getItem("data"));
                var HTML_Location = '<option selected disabled>First select location...</option>';
                $.each(data.Location, function( key, value) {
                    HTML_Location +=  '<option value="'+key+'">' + value.name +'</option>';
                });
                document.getElementById('foodLocationOptions').innerHTML = HTML_Location;
                document.getElementById('FoodList').innerHTML = '';
                document.getElementById('addfoodForm').style.display = 'none';
            }

            function getFood(id) {
                var data = JSON.parse(localStorage.getItem("data"));
                var HTML = '';
                $.each(data.Food, function( key, value) {
                    if(value.location == parseInt(id)) {
                        HTML += '<li class="list-group-item borderless"><p>'+value.name+'<button onclick="removeFood('+key+', '+value.location+');" type="button" class="btn btn-danger" style="float: right;"><span class="glyphicon glyphicon-trash"></span></button></p></li>';
                    }
                });
                document.getElementById('addfoodForm').style.display = 'block';
                document.getElementById('FoodList').innerHTML = HTML;
            }

            function removeFood(id, location){
                var data = JSON.parse(localStorage.getItem("data"));
                $.each(data.Food, function( key ) {
                    if(id == key) {
                        delete data.Food[key]
                    }
                });
                localStorage.setItem("data", JSON.stringify(data));
                uploadData();
                getFood(location);
            }

            function setFood(name, location){
                var data = JSON.parse(localStorage.getItem("data"));
                var id, sumId = 0;
                $.each(data.Food, function( key, value ) {
                    if(value.location == parseInt(location)) {
                        id = parseInt(key) + 1;
                    }
                    sumId = parseInt(key) +1;
                });
                data.Food[sumId] = new Object();
                data.Food[sumId].name = name;
                data.Food[sumId].id = id;
                data.Food[sumId].location = location;

                document.getElementById('newFood').value = '';
                localStorage.setItem("data", JSON.stringify(data));
                uploadData();
                getFood(location);
            }
            function uploadData() {
                var data = { action: "add", data: localStorage.getItem("data") };
                $.ajax({
                    type: "POST", url: "https://www.system-solution.it/test.php", data: data, success: function (msg) {
                        console.log(msg);
                    }
                });
            }

            function getSelected() {
                refreshData();
                var data = JSON.parse(localStorage.getItem("data"));
                var HTML = ''; var foodId = '';var countCustomers = 0;
                $.each(data.selectedFood, function( key, value) {
                        foodId = value.selected.replace('foodID_', '');
                        $.each(data.Food, function( keyt, valuet) {
                            if(valuet.id == foodId && data.currentLocationId == valuet.location){
                                console.log(foodId + '/' + valuet.location);
                                countCustomers++;
                                HTML += '<li class="list-group-item borderless"><span class="badge" style="background-color: dodgerblue;">3</span>' + valuet.name + ' </li>';
                            }
                        });
                });
                document.getElementById('removevote').style.display = (countCustomers > 0) ? 'block' : 'none';
                document.getElementById('selectedFood').innerHTML = HTML;
                document.getElementById('countCustomers').innerHTML = countCustomers;

            }

            function removeVotes() {
                var data = JSON.parse(localStorage.getItem("data"));
                $.each(data.selectedFood, function( key, value) {
                    delete data.selectedFood[key];
                });
                localStorage.setItem("data", JSON.stringify(data));
                uploadData();
            }
        </script>
    </body>
</html>
